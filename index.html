<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNOC RELAY - Olympic Solidarity Funding Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #0081C8;
            --secondary-blue: #0051A5;
            --success-green: #10B981;
            --warning-yellow: #F59E0B;
            --danger-red: #EF4444;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.5;
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Login Page */
        .login-container {
            display: none;
            min-height: 100vh;
            background-color: var(--gray-50);
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .login-container.active {
            display: flex;
        }

        .login-box {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-error {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger-red);
            color: var(--danger-red);
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            display: none;
        }

        /* Header Styles */
        .header {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: var(--primary-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .site-title {
            display: flex;
            flex-direction: column;
        }

        .site-title h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .site-title p {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-900);
        }

        .user-role {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--secondary-blue);
        }

        .btn-secondary {
            background-color: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: var(--gray-300);
        }

        .btn-success {
            background-color: var(--success-green);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-red);
            color: white;
        }

        /* Navigation */
        .nav {
            background-color: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 0 2rem;
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 2rem;
        }

        .nav-item {
            padding: 1rem 0;
            color: var(--gray-600);
            text-decoration: none;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            color: var(--primary-blue);
        }

        .nav-item.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }

        /* Main Content */
        .main-container {
            display: none;
        }

        .main-container.active {
            display: block;
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-icon.blue {
            background-color: rgba(0, 129, 200, 0.1);
            color: var(--primary-blue);
        }

        .stat-icon.green {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
        }

        .stat-icon.yellow {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-yellow);
        }

        .stat-icon.purple {
            background-color: rgba(139, 92, 246, 0.1);
            color: #8B5CF6;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        /* Quick Actions */
        .quick-actions {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .quick-actions h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--gray-900);
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-card {
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--gray-50);
        }

        .action-card:hover {
            background: white;
            border-color: var(--primary-blue);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .action-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .action-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .action-description {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: var(--gray-50);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
            border-bottom: 1px solid var(--gray-200);
        }

        td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-100);
        }

        tr:hover {
            background-color: var(--gray-50);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.active {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
        }

        .status-badge.pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-yellow);
        }

        .status-badge.completed {
            background-color: rgba(59, 130, 246, 0.1);
            color: #3B82F6;
        }

        .status-badge.approved {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
        }

        .status-badge.rejected {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-red);
        }

        /* Forms */
        .form-container {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 129, 200, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-500);
        }

        /* Messages */
        .success-message, .error-message, .warning-message {
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }

        .success-message {
            background-color: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success-green);
            color: var(--success-green);
        }

        .error-message {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger-red);
            color: var(--danger-red);
        }

        .warning-message {
            background-color: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning-yellow);
            color: var(--warning-yellow);
        }

        /* Search Bar */
        .search-container {
            position: relative;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-content {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .main-content {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<script>
// Authentication check - add this at the beginning of your index.html
(function checkAuth() {
    const token = localStorage.getItem('relayToken');
    const user = localStorage.getItem('relayUser');
    
    // If not logged in, redirect to login page
    if (!token || !user) {
        window.location.href = 'login.html';
        return;
    }
    
    // Parse user data and update UI
    try {
        const userData = JSON.parse(user);
        // Update the username display
        const userNameElement = document.getElementById('userName');
        if (userNameElement) {
            userNameElement.textContent = userData.name || 'Test User';
        }
        const userRoleElement = document.getElementById('userRole');
        if (userRoleElement) {
            userRoleElement.textContent = userData.role || 'Administrator';
        }
    } catch (e) {
        console.error('Error parsing user data:', e);
    }
})();

// Update the logout function
function showLogin() {
    if (confirm('Are you sure you want to logout?')) {
        // Clear stored data
        localStorage.removeItem('relayToken');
        localStorage.removeItem('relayUser');
        localStorage.removeItem('itad_activities');
        localStorage.removeItem('itad_vessels');
        localStorage.removeItem('relayActivities');
        localStorage.removeItem('relayApplications');
        localStorage.removeItem('relayReports');
        
        // Redirect to login
        window.location.href = 'login.html';
    }
}
</script>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-logo">
                <div class="logo" style="width: 80px; height: 80px; margin: 0 auto; font-size: 2rem;">PNOC</div>
                <h2 style="margin-top: 1rem; color: var(--gray-900);">RELAY Platform Login</h2>
                <p style="color: var(--gray-600); margin-top: 0.5rem;">Olympic Solidarity Funding Tracker</p>
            </div>
            
            <div class="login-error" id="loginError"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            
            <p style="text-align: center; margin-top: 1rem; color: var(--gray-600); font-size: 0.875rem;">
                Default: admin@palaunoc.org / admin123
            </p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container" id="mainContainer">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">PNOC</div>
                    <div class="site-title">
                        <h1>RELAY Platform</h1>
                        <p>Olympic Solidarity Funding Tracker</p>
                    </div>
                </div>
                <div class="user-section">
                    <div class="user-info">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-role" id="userRole">...</div>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()">Logout</button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-content">
                <a class="nav-item active" onclick="showPage('dashboard')">Dashboard</a>
                <a class="nav-item" onclick="showPage('activities')">Activities</a>
                <a class="nav-item" onclick="showPage('applications')">Applications</a>
                <a class="nav-item" onclick="showPage('reports')">Reports</a>
                <a class="nav-item" onclick="showPage('settings')">Settings</a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">üìä</div>
                        <div class="stat-value" id="activePrograms">0</div>
                        <div class="stat-label">Active Programs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">üí∞</div>
                        <div class="stat-value" id="totalFunding">$0</div>
                        <div class="stat-label">Total Funding</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon yellow">‚è≥</div>
                        <div class="stat-value" id="pendingApps">0</div>
                        <div class="stat-label">Pending Applications</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">üèÖ</div>
                        <div class="stat-value" id="federations">15</div>
                        <div class="stat-label">Sports Federations</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-grid">
                        <div class="action-card" onclick="showNewApplicationModal()">
                            <div class="action-icon">üìù</div>
                            <div class="action-title">New Application</div>
                            <div class="action-description">Submit funding request</div>
                        </div>
                        <div class="action-card" onclick="generateReport()">
                            <div class="action-icon">üìÑ</div>
                            <div class="action-title">Generate Report</div>
                            <div class="action-description">Create activity report</div>
                        </div>
                        <div class="action-card" onclick="showPage('activities')">
                            <div class="action-icon">üìå</div>
                            <div class="action-title">Track Activity</div>
                            <div class="action-description">Update program status</div>
                        </div>
                        <div class="action-card" onclick="showMessage('Calendar feature coming soon!', 'warning')">
                            <div class="action-icon">üìÖ</div>
                            <div class="action-title">Calendar</div>
                            <div class="action-description">View upcoming events</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Recent Activities</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Activity Name</th>
                                <th>Program</th>
                                <th>Federation</th>
                                <th>Start Date</th>
                                <th>Budget</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivitiesTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                    Loading activities...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Activities Page -->
            <div id="activities" class="page">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">All Activities</h2>
                        <button class="btn btn-primary" onclick="showNewActivityModal()">Add New Activity</button>
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <div class="search-container" style="display: inline-block;">
                            <span class="search-icon">üîç</span>
                            <input type="text" class="search-input" id="activitySearch" placeholder="Search activities..." onkeyup="searchActivities()">
                        </div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Activity Name</th>
                                <th>Program</th>
                                <th>Federation</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Budget</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="activitiesTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                    Loading activities...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Applications Page -->
            <div id="applications" class="page">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Funding Applications</h2>
                        <button class="btn btn-primary" onclick="showNewApplicationModal()">New Application</button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Application ID</th>
                                <th>Program</th>
                                <th>Federation</th>
                                <th>Requested Amount</th>
                                <th>Submission Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="applicationsTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                    Loading applications...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports" class="page">
                <div class="form-container">
                    <h2 style="margin-bottom: 2rem;">Generate Reports</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Report Type</label>
                        <select class="form-select" id="reportType">
                            <option value="">Select Report Type</option>
                            <option value="funding">Funding Summary Report</option>
                            <option value="activity">Activity Status Report</option>
                            <option value="federation">Federation Performance Report</option>
                            <option value="quarterly">Quarterly Progress Report</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-input" id="reportStartDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-input" id="reportEndDate">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Federation (Optional)</label>
                        <select class="form-select" id="reportFederation">
                            <option value="">All Federations</option>
                            <option value="PNOC Medical Commission">PNOC Medical Commission</option>
                            <option value="Palau Swimming">Palau Swimming</option>
                            <option value="Palau Athletics">Palau Athletics</option>
                            <option value="Palau Weightlifting">Palau Weightlifting</option>
                            <option value="Palau Basketball">Palau Basketball</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
                </div>

                <div class="table-container" style="margin-top: 2rem;">
                    <h3 class="table-title">Generated Reports</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Report Name</th>
                                <th>Type</th>
                                <th>Date Generated</th>
                                <th>Generated By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTable">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                    No reports generated yet.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="form-container">
                    <h2 style="margin-bottom: 2rem;">User Settings</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-input" id="settingsName" disabled>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="settingsEmail" disabled>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <input type="text" class="form-input" id="settingsRole" disabled>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Federation</label>
                        <input type="text" class="form-input" id="settingsFederation" disabled>
                    </div>

                    <p style="color: var(--gray-600); font-size: 0.875rem;">
                        Contact your administrator to update your profile information.
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- New Activity Modal -->
    <div id="newActivityModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('newActivityModal')">&times;</button>
            <h2 style="margin-bottom: 1.5rem;">Add New Activity</h2>
            
            <form id="newActivityForm">
                <div class="form-group">
                    <label class="form-label">Activity Name *</label>
                    <input type="text" class="form-input" id="activityName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Program *</label>
                        <select class="form-select" id="activityProgram" required>
                            <option value="">Select Program</option>
                            <option value="National Sports System">Development of National Sports System</option>
                            <option value="Athletes Support">Athletes Support</option>
                            <option value="Coaches Education">Coaches Education</option>
                            <option value="Sports Administration">Sports Administration</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Federation *</label>
                        <select class="form-select" id="activityFederation" required>
                            <option value="">Select Federation</option>
                            <option value="PNOC Medical Commission">PNOC Medical Commission</option>
                            <option value="Palau Swimming">Palau Swimming</option>
                            <option value="Palau Athletics">Palau Athletics</option>
                            <option value="Palau Weightlifting">Palau Weightlifting</option>
                            <option value="Palau Basketball">Palau Basketball</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Date *</label>
                        <input type="date" class="form-input" id="activityStartDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date *</label>
                        <input type="date" class="form-input" id="activityEndDate" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Budget (USD) *</label>
                        <input type="number" class="form-input" id="activityBudget" min="0" step="100" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status *</label>
                        <select class="form-select" id="activityStatus" required>
                            <option value="pending">Pending</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="activityDescription" rows="3"></textarea>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('newActivityModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Activity</button>
                </div>
            </form>
        </div>
    </div>

    <!-- New Application Modal -->
    <div id="newApplicationModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('newApplicationModal')">&times;</button>
            <h2 style="margin-bottom: 1.5rem;">New Funding Application</h2>
            
            <form id="newApplicationForm">
                <div class="form-group">
                    <label class="form-label">Program *</label>
                    <select class="form-select" id="appProgram" required>
                        <option value="">Select Program</option>
                        <option value="National Sports System">Development of National Sports System</option>
                        <option value="Athletes Support">Athletes Support</option>
                        <option value="Coaches Education">Coaches Education</option>
                        <option value="Sports Administration">Sports Administration</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Federation *</label>
                    <select class="form-select" id="appFederation" required>
                        <option value="">Select Federation</option>
                        <option value="PNOC Medical Commission">PNOC Medical Commission</option>
                        <option value="Palau Swimming">Palau Swimming</option>
                        <option value="Palau Athletics">Palau Athletics</option>
                        <option value="Palau Weightlifting">Palau Weightlifting</option>
                        <option value="Palau Basketball">Palau Basketball</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Project Title *</label>
                    <input type="text" class="form-input" id="appTitle" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Requested Amount (USD) *</label>
                    <input type="number" class="form-input" id="appAmount" min="0" step="100" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Project Description *</label>
                    <textarea class="form-textarea" id="appDescription" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Expected Outcomes</label>
                    <textarea class="form-textarea" id="appOutcomes" rows="3"></textarea>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('newApplicationModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://206.189.153.148/api';
        let authToken = localStorage.getItem('relayToken');
        let currentUser = null;

        // API Helper Class
        class RelayAPI {
            constructor() {
                this.baseURL = API_BASE_URL;
                this.token = authToken;
            }

            async request(endpoint, options = {}) {
                const config = {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers,
                    }
                };

                if (this.token) {
                    config.headers.Authorization = `Bearer ${this.token}`;
                }

                try {
                    showLoading(true);
                    const response = await fetch(`${this.baseURL}${endpoint}`, config);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || 'API request failed');
                    }

                    return data;
                } catch (error) {
                    console.error('API Error:', error);
                    throw error;
                } finally {
                    showLoading(false);
                }
            }

            // Auth methods
            async login(email, password) {
                const data = await this.request('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                this.token = data.token;
                authToken = data.token;
                localStorage.setItem('relayToken', data.token);
                currentUser = data.user;
                
                return data;
            }

            async logout() {
                this.token = null;
                authToken = null;
                currentUser = null;
                localStorage.removeItem('relayToken');
            }

            async getCurrentUser() {
                return await this.request('/auth/me');
            }

            // Activities methods
            async getActivities() {
                return await this.request('/activities');
            }

            async createActivity(activity) {
                return await this.request('/activities', {
                    method: 'POST',
                    body: JSON.stringify(activity)
                });
            }

            async deleteActivity(id) {
                return await this.request(`/activities/${id}`, {
                    method: 'DELETE'
                });
            }

            // Applications methods
            async getApplications() {
                return await this.request('/applications');
            }

            async createApplication(application) {
                return await this.request('/applications', {
                    method: 'POST',
                    body: JSON.stringify(application)
                });
            }

            async reviewApplication(id, review) {
                return await this.request(`/applications/${id}/review`, {
                    method: 'PUT',
                    body: JSON.stringify(review)
                });
            }

            // Reports methods
            async getReports() {
                return await this.request('/reports');
            }

            async generateReport(reportConfig) {
                return await this.request('/reports/generate', {
                    method: 'POST',
                    body: JSON.stringify(reportConfig)
                });
            }

            // Dashboard methods
            async getDashboardStats() {
                return await this.request('/dashboard/stats');
            }
        }

        // Initialize API
        const api = new RelayAPI();

        // Helper Functions
        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('active', show);
        }

        function showMessage(message, type = 'success') {
            alert(message);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString();
        }

        function formatCurrency(amount) {
            return '$' + (amount || 0).toLocaleString();
        }

        // UI Functions
        function showLogin() {
            document.getElementById('loginContainer').classList.add('active');
            document.getElementById('mainContainer').classList.remove('active');
        }

        function showMain() {
            document.getElementById('loginContainer').classList.remove('active');
            document.getElementById('mainContainer').classList.add('active');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showNewActivityModal() {
            showModal('newActivityModal');
        }

        function showNewApplicationModal() {
            showModal('newApplicationModal');
        }

        // Page Navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageName).classList.add('active');
            
            // Update nav active state
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Load page data
            if (pageName === 'dashboard') {
                updateDashboard();
            } else if (pageName === 'activities') {
                loadActivities();
            } else if (pageName === 'applications') {
                loadApplications();
            } else if (pageName === 'reports') {
                loadReports();
            }
        }

        // Authentication
        async function login(email, password) {
            try {
                const result = await api.login(email, password);
                updateUserInfo();
                showMain();
                updateDashboard();
                document.getElementById('loginError').style.display = 'none';
            } catch (error) {
                const errorDiv = document.getElementById('loginError');
                errorDiv.textContent = error.message || 'Invalid credentials';
                errorDiv.style.display = 'block';
            }
        }

        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                await api.logout();
                showLogin();
                document.getElementById('loginForm').reset();
            }
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userRole').textContent = currentUser.role;
                document.getElementById('settingsName').value = currentUser.name;
                document.getElementById('settingsEmail').value = currentUser.email;
                document.getElementById('settingsRole').value = currentUser.role;
                document.getElementById('settingsFederation').value = currentUser.federation || 'N/A';
            }
        }

        // Dashboard Functions
        async function updateDashboard() {
            try {
                const stats = await api.getDashboardStats();
                
                // Update statistics
                document.getElementById('activePrograms').textContent = stats.activePrograms || 0;
                document.getElementById('totalFunding').textContent = formatCurrency(stats.totalFunding);
                document.getElementById('pendingApps').textContent = stats.pendingApplications || 0;
                
                // Update recent activities table
                const tableBody = document.getElementById('recentActivitiesTable');
                tableBody.innerHTML = '';
                
                if (stats.recentActivities && stats.recentActivities.length > 0) {
                    stats.recentActivities.forEach(activity => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><strong>${activity.name}</strong></td>
                            <td>${activity.program}</td>
                            <td>${activity.federation}</td>
                            <td>${formatDate(activity.startDate)}</td>
                            <td>${formatCurrency(activity.budget)}</td>
                            <td><span class="status-badge ${activity.status}">${activity.status}</span></td>
                            <td>
                                <button class="btn btn-secondary" onclick="viewActivity('${activity._id}')">View</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    tableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);">No recent activities</td></tr>`;
                }
            } catch (error) {
                console.error('Dashboard error:', error);
                showMessage('Error loading dashboard', 'error');
            }
        }

        // Activities Functions
        async function loadActivities() {
            try {
                const activities = await api.getActivities();
                const tableBody = document.getElementById('activitiesTable');
                tableBody.innerHTML = '';
                
                if (activities.length > 0) {
                    activities.forEach(activity => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><strong>${activity.name}</strong></td>
                            <td>${activity.program}</td>
                            <td>${activity.federation}</td>
                            <td>${formatDate(activity.startDate)}</td>
                            <td>${formatDate(activity.endDate)}</td>
                            <td>${formatCurrency(activity.budget)}</td>
                            <td><span class="status-badge ${activity.status}">${activity.status}</span></td>
                            <td>
                                <button class="btn btn-secondary" onclick="editActivity('${activity._id}')">Edit</button>
                                <button class="btn btn-danger" onclick="deleteActivity('${activity._id}')">Delete</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    tableBody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray-500);">No activities found</td></tr>`;
                }
            } catch (error) {
                console.error('Activities error:', error);
                showMessage('Error loading activities', 'error');
            }
        }

        async function deleteActivity(id) {
            if (confirm('Are you sure you want to delete this activity?')) {
                try {
                    await api.deleteActivity(id);
                    showMessage('Activity deleted successfully');
                    loadActivities();
                    updateDashboard();
                } catch (error) {
                    showMessage('Error deleting activity', 'error');
                }
            }
        }

        function editActivity(id) {
            showMessage('Edit functionality coming soon', 'warning');
        }

        function viewActivity(id) {
            showMessage('View functionality coming soon', 'warning');
        }

        function searchActivities() {
            const searchTerm = document.getElementById('activitySearch').value.toLowerCase();
            const rows = document.querySelectorAll('#activitiesTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Applications Functions
        async function loadApplications() {
            try {
                const applications = await api.getApplications();
                const tableBody = document.getElementById('applicationsTable');
                tableBody.innerHTML = '';
                
                if (applications.length > 0) {
                    applications.forEach(app => {
                        const row = document.createElement('tr');
                        const canReview = currentUser && currentUser.role === 'administrator' && app.status === 'pending';
                        
                        row.innerHTML = `
                            <td>${app._id.substring(0, 8)}</td>
                            <td>${app.program}</td>
                            <td>${app.federation}</td>
                            <td>${formatCurrency(app.amount)}</td>
                            <td>${formatDate(app.submissionDate)}</td>
                            <td><span class="status-badge ${app.status}">${app.status}</span></td>
                            <td>
                                ${canReview ? `
                                    <button class="btn btn-success" onclick="approveApplication('${app._id}')">Approve</button>
                                    <button class="btn btn-danger" onclick="rejectApplication('${app._id}')">Reject</button>
                                ` : '-'}
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    tableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);">No applications found</td></tr>`;
                }
            } catch (error) {
                console.error('Applications error:', error);
                showMessage('Error loading applications', 'error');
            }
        }

        async function approveApplication(id) {
            try {
                await api.reviewApplication(id, { 
                    status: 'approved',
                    reviewComments: 'Application approved' 
                });
                showMessage('Application approved successfully');
                loadApplications();
                updateDashboard();
            } catch (error) {
                showMessage('Error approving application', 'error');
            }
        }

        async function rejectApplication(id) {
            const reason = prompt('Please provide a reason for rejection:');
            if (reason) {
                try {
                    await api.reviewApplication(id, { 
                        status: 'rejected',
                        reviewComments: reason 
                    });
                    showMessage('Application rejected');
                    loadApplications();
                } catch (error) {
                    showMessage('Error rejecting application', 'error');
                }
            }
        }

        // Reports Functions
        async function loadReports() {
            try {
                const reports = await api.getReports();
                const tableBody = document.getElementById('reportsTable');
                tableBody.innerHTML = '';
                
                if (reports.length > 0) {
                    reports.forEach(report => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${report.name}</td>
                            <td>${report.type}</td>
                            <td>${formatDate(report.createdAt)}</td>
                            <td>${report.generatedBy?.name || 'System'}</td>
                            <td>
                                <button class="btn btn-primary" onclick="viewReport('${report._id}')">View</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    tableBody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--gray-500);">No reports generated yet</td></tr>`;
                }
            } catch (error) {
                console.error('Reports error:', error);
            }
        }

        async function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const federation = document.getElementById('reportFederation').value;
            
            if (!reportType) {
                showMessage('Please select a report type', 'error');
                return;
            }
            
            try {
                const report = await api.generateReport({
                    type: reportType,
                    startDate,
                    endDate,
                    federation: federation || undefined
                });
                
                showMessage('Report generated successfully');
                loadReports();
            } catch (error) {
                showMessage('Error generating report', 'error');
            }
        }

        function viewReport(id) {
            showMessage('Report viewing coming soon', 'warning');
        }

        // Form Submissions
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            await login(email, password);
        });

        document.getElementById('newActivityForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const newActivity = {
                    name: document.getElementById('activityName').value,
                    program: document.getElementById('activityProgram').value,
                    federation: document.getElementById('activityFederation').value,
                    startDate: document.getElementById('activityStartDate').value,
                    endDate: document.getElementById('activityEndDate').value,
                    budget: parseInt(document.getElementById('activityBudget').value),
                    status: document.getElementById('activityStatus').value,
                    description: document.getElementById('activityDescription').value
                };
                
                await api.createActivity(newActivity);
                closeModal('newActivityModal');
                this.reset();
                showMessage('Activity created successfully');
                loadActivities();
                updateDashboard();
            } catch (error) {
                showMessage('Error creating activity', 'error');
            }
        });

        document.getElementById('newApplicationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const newApplication = {
                    program: document.getElementById('appProgram').value,
                    federation: document.getElementById('appFederation').value,
                    title: document.getElementById('appTitle').value,
                    amount: parseInt(document.getElementById('appAmount').value),
                    description: document.getElementById('appDescription').value,
                    outcomes: document.getElementById('appOutcomes').value
                };
                
                await api.createApplication(newApplication);
                closeModal('newApplicationModal');
                this.reset();
                showMessage('Application submitted successfully');
                loadApplications();
                updateDashboard();
            } catch (error) {
                showMessage('Error submitting application', 'error');
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            if (authToken) {
                try {
                    currentUser = await api.getCurrentUser();
                    updateUserInfo();
                    showMain();
                    updateDashboard();
                } catch (error) {
                    console.error('Auth check failed:', error);
                    showLogin();
                }
            } else {
                showLogin();
            }
        });
    </script>
</body>
</html>

